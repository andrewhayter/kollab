<!doctype html>
<html>
  <head>
    <title>Socket.IO chat</title>
    <link rel="stylesheet" type="text/css" href="public/style.css">

    <script src="/socket.io/socket.io.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
  </head>
  <body>

    <div class="chatboard">
      <ul id="messages"></ul>
      <form id="form" action="">
        <input id="m" autocomplete="off" /><button>Send</button>
      </form>
    <div>

    <div class="musicboard">
      <button class="kick">kick</button>
    </div>


    <script src="samplearray.js"></script>
    <script src="oscillator.js"></script>
    <script>

    
    /*
    
  

    Promise.all(Object.keys(samples).map(function(key)
    {
      var sample = samples[key];

      return new Promise(function(resolve, reject)
      {
        
      });
    }))
    .then(function(samples)
    {
      //This merges all objects into one
      return samples.reduce(function(acc, item)
      {
        return $.extend(acc, item);
      });
    })
    .then(function(samples)
    {
      var obj = {};
      $.map(samples, function(buffer, name)
      {
        ctx.decodeAudioData(buffer, function(sample)
        {
          
          obj[name] = play;
        });
      });
      return obj; 
    })
    .then(function allSamplesLoaded(kit)
    {
      console.log(kit);
      window.kit = kit;
    })
    .catch(function(ex)
    {
      console.error(ex);
    })
    ;
 
    */

//

    // var context = new AudioContext(); // Create and Initialize the Audio Context
    // var kick; // Create the Sound 
    // var getSound = new XMLHttpRequest(); // Load the Sound with XMLHttpRequest
    // getSound.open("GET", "samples/kicks/apunch_kik.wav", true); // Path to Audio File
    // getSound.responseType = "arraybuffer"; // Read as Binary Data
    // getSound.onload = function() {
    //   context.decodeAudioData(getSound.response, function(buffer){
    //     kick = buffer; // Decode the Audio Data and Store it in a Variable
    //   });
    // }

    // getSound.send(); //send request and load file

    // // window.addEventListener("keydown",playkick); // Create Event Listener for KeyDown

    // var context2 = new AudioContext(); // Create and Initialize the Audio Context
    // var hat; // Create the Sound 
    // var getSound2 = new XMLHttpRequest(); // Load the Sound with XMLHttpRequest
    // getSound2.open("GET", "samples/hats/at_hats.wav", true); // Path to Audio File
    // getSound2.responseType = "arraybuffer"; // Read as Binary Data
    // getSound2.onload = function() {
    //   context2.decodeAudioData(getSound2.response, function(buffer){
    //     hat = buffer; // Decode the Audio Data and Store it in a Variable
    //   });
    // }

    // getSound2.send();


    // function playkick(e){
    //   switch (e) {
    //     case 1:
    //       var playSound = context.createBufferSource(); // Declare a New Sound
    //       playSound.buffer = kick; // Attatch our Audio Data as it's Buffer
    //       playSound.connect(context.destination);  // Link the Sound to the Output
    //       playSound.start(0); // Play the Sound Immediately
    //     break;
    //     case 2:
    //       var playSound = context2.createBufferSource(); // Declare a New Sound
    //       playSound.buffer = hat; // Attatch our Audio Data as it's Buffer
    //       playSound.connect(context2.destination);  // Link the Sound to the Output
    //       playSound.start(0); // Play the Sound Immediately
    //   }
    // };

</script>
<script>
      var socket = io();
      $('form').submit(function(){
        socket.emit('chat message', $('#m').val());
        $('#m').val('');
        return false;
      });


      socket.on('chat message', function(msg){
        $('#messages').append($('<li>').text(msg).css("border-radius","10px"));
      });


      $('.sound').click(function(){
        socket.emit('sound');
      });


      socket.on('sound', function(){
        oscillator.start();

        $('#messages').append($('<li>').text("sent sound").css("border-radius","10px"));
      });

//kick button
      $('.kick').click(function(){
        socket.emit('kick');
      });


      socket.on('kick', function(){
        kit[1].play();
        $('#messages').append($('<li>').text("sent kick").css("border-radius","10px"));
      });
//kick keydown      
        

      $(document).on('keydown', function(event) {
         if (event.keyCode == 88) {
              console.log('x');
              socket.emit('keypress');
         }

         if (event.keyCode == 89) {
              console.log('y');
              socket.emit('keypress2');
         }

      });      


      socket.on('keypress', function(){
        kit[1].play();
        $('#messages').append($('<li>').text("sent kick").css("border-radius","10px"));
      });

      socket.on('keypress2', function(){
        kit[2].play();
        $('#messages').append($('<li>').text("sent hat").css("border-radius","10px"));
      });



    </script>

  </body>
</html>